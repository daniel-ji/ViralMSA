<!DOCTYPE html>
<html>
<head>
    <link rel="icon" type="image/x-icon" href="./favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/pyodide/v0.22.1/full/pyodide.js"></script>
    <link rel="stylesheet" href="assets/index.css">
</head>
<body>
    <h1 class="my-5 text-center">ViralMSA Online Tool</h1>
    <script>
        // constants
        const PATH_TO_PYODIDE_ROOT = "/home/pyodide/";

        let pyodide; 
        const initPyodide = async () => {
            // load pyodide
            pyodide = await loadPyodide();
            
            // load micropip, a package manager for Pyodide
            await pyodide.loadPackage("micropip");
            const micropip = pyodide.pyimport("micropip");
            
            // install biopython, a ViralMSA dependency
            await micropip.install('biopython');
            
            // load in ViralMSA.py
            pyodide.FS.writeFile(PATH_TO_PYODIDE_ROOT + 'ViralMSA.py', await (await fetch("./assets/python/ViralMSA.py")).text(), { encoding: "utf8" });

            // set global args variable
            let arguments = "./ViralMSA.py -e email@address.com -s example/example_hiv.fas -o output -r HIV-1";
            pyodide.globals.set("arguments", arguments); 

            // run ViralMSAWeb.py
            pyodide.runPython(await (await fetch("./assets/python/ViralMSAWeb.py")).text())
        }
        initPyodide();
    </script>
</body>
</html>